{% extends 'base/base.html' %}

{% block title %}
  Dashboard
{% endblock %}

{% block content %}

<style>
  .fa-caret-square-o-right {
    color: #6c7ae0;
  }
  .fa-check-square-o {
    color: #6c7ae0;
  }
  
  /* Modern Dashboard Styling */
  .dashboard-stats {
    margin-top: 10px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
  }
  
  .stat-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
  }
  
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
  }
  
  .stat-icon {
    font-size: 1.8rem;
    color: #6c7ae0;
    margin-bottom: 8px;
  }
  
  .stat-number {
    font-size: 1.6rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 3px;
  }
  
  .stat-label {
    color: #666;
    font-size: 0.8rem;
    margin-bottom: 6px;
  }
  
  .stat-change {
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 8px;
    background: #e8f5e8;
    color: #27ae60;
  }
  
  /* Dashboard specific hover enhancements */
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    background: linear-gradient(135deg, #f7d794, #f5d577);
  }
  
  .expired-item:hover {
    background: #f7d794;
    border-radius: 6px;
  }
  
  .expired-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  }
  
  .chart-container {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
  }
  
  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 12px;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .chart-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2c3e50;
  }
  
  .summary-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .summary-card {
    background: linear-gradient(135deg, #6c7ae0, #5a67d8);
    border-radius: 12px;
    padding: 20px;
    color: white;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  
  .summary-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: rotate(45deg);
    transition: all 0.6s;
  }
  
  .summary-card:hover::before {
    animation: shimmer 1.5s ease-in-out;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
  }
  
  .expired-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 15px;
  }
  
  .expired-card {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
  }
  
  .expired-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  }
  
  .expired-header {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    color: white;
    padding: 12px 15px;
    font-weight: 600;
    font-size: 0.9rem;
  }
  
  .expired-content {
    max-height: 250px;
    overflow-y: auto;
    padding: 10px;
  }
  
  .expired-item {
    padding: 10px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    align-items: center;
    transition: all 0.2s ease;
  }
  
  .expired-item:hover {
    background: #f7d794;
    border-radius: 6px;
  }
  
  .expired-item:last-child {
    border-bottom: none;
  }
  
  .expired-avatar {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #6c7ae0, #5a67d8);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    margin-right: 12px;
    font-size: 0.8rem;
  }
  
  .expired-details h6 {
    margin: 0 0 3px 0;
    color: #2c3e50;
    font-weight: 600;
    font-size: 0.85rem;
  }
  
  .expired-details p {
    margin: 0;
    font-size: 0.75rem;
    color: #666;
  }
  
  .danger-badge {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    color: white;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 500;
    margin-left: auto;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- page content -->
<div class="right_col" role="main">
  
  <!-- Modern Stats Section -->
  <div class="dashboard-stats">
    <h2 style="margin-bottom: 15px; font-weight: 300; font-size: 1.3rem;">System Overview</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-users"></i>
        </div>
        <div class="stat-number">163</div>
        <div class="stat-label">Total Man Power</div>
        <div class="stat-change">+4% from last week</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-user"></i>
        </div>
        <div class="stat-number">{{ total_drivers }}</div>
        <div class="stat-label">Total Drivers</div>
        <div class="stat-change">+3% from last week</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-truck"></i>
        </div>
        <div class="stat-number">{{ total_vehicles }}</div>
        <div class="stat-label">Total Vehicles</div>
        <div class="stat-change">+34% from last week</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-briefcase"></i>
        </div>
        <div class="stat-number">{{ man_days_work }}</div>
        <div class="stat-label">Man Days Worked</div>
        <div class="stat-change" style="background: #ffe8e8; color: #e74c3c;">-12% from last week</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-exclamation-triangle"></i>
        </div>
        <div class="stat-number">0</div>
        <div class="stat-label">Man Days Lost</div>
        <div class="stat-change">+0% from last week</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-ban"></i>
        </div>
        <div class="stat-number">0</div>
        <div class="stat-label">Total Incidents</div>
        <div class="stat-change">+0% from last week</div>
      </div>
    </div>
  </div>

  <!-- Tool Box Meeting Chart -->
  <div class="chart-container">
    <div class="chart-header">
      <div>
        <h3 class="chart-title">Tool Box Meeting Sessions</h3>
        <p style="color: #666; margin: 0;">Training participation overview</p>
      </div>
      {% comment %} <div id="reportrange" class="btn" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 8px 16px;">
        <i class="fa fa-calendar"></i>
        <span>December 30, 2024 - January 28, 2025</span> <i class="fa fa-caret-down"></i>
      </div> {% endcomment %}
    </div>
    <div style="position: relative; height: 300px;">
      <canvas id="barChart"></canvas>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="stat-icon" style="color: white; margin-bottom: 8px; font-size: 1.5rem;">
        <i class="fa fa-caret-square-o-right"></i>
      </div>
      <div style="font-size: 1.8rem; font-weight: bold; margin-bottom: 3px;">179</div>
      <div style="font-size: 0.9rem;">Total Sessions</div>
    </div>
    
    <div class="summary-card">
      <div class="stat-icon" style="color: white; margin-bottom: 8px; font-size: 1.5rem;">
        <i class="fa fa-check-square-o"></i>
      </div>
      <div style="font-size: 1.8rem; font-weight: bold; margin-bottom: 3px;">9,672</div>
      <div style="font-size: 0.9rem;">Participants</div>
    </div>
  </div>

  <!-- Expired Documents Section -->
  <div class="expired-sections">
    <div class="expired-card">
      <div class="expired-header">
        <i class="fa fa-id-card" style="margin-right: 10px;"></i>
        Expired CNIC
      </div>
      <div class="expired-content">
        {% for driver in expired_cnic_list %}
          <div class="expired-item">
            <div class="expired-avatar">
              <i class="fa fa-user"></i>
            </div>
            <div class="expired-details">
              <h6><a href="{% url 'driverview' driver_id=driver.D_ID %}" style="text-decoration: none; color: #2c3e50;">{{ driver.D_Name }}</a></h6>
              <p><strong>{{ driver.D_Number }}</strong> | {{ driver.CNIC_Validity }}</p>
            </div>
            <span class="danger-badge">Expired</span>
          </div>
        {% empty %}
          <div style="text-align: center; color: #666; padding: 20px;">
            <i class="fa fa-check-circle" style="font-size: 1.5rem; color: #27ae60; margin-bottom: 8px;"></i>
            <p style="margin: 0; font-size: 0.8rem;">No expired CNICs</p>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="expired-card">
      <div class="expired-header">
        <i class="fa fa-certificate" style="margin-right: 10px;"></i>
        Expired DDC
      </div>
      <div class="expired-content">
        {% for driver in expired_ddc_list %}
          <div class="expired-item">
            <div class="expired-avatar">
              <i class="fa fa-user"></i>
            </div>
            <div class="expired-details">
              <h6><a href="{% url 'driverview' driver_id=driver.D_ID %}" style="text-decoration: none; color: #2c3e50;">{{ driver.D_Name }}</a></h6>
              <p><strong>{{ driver.D_Number }}</strong> | {{ driver.CNIC_Validity }}</p>
            </div>
            <span class="danger-badge">Expired</span>
          </div>
        {% empty %}
          <div style="text-align: center; color: #666; padding: 20px;">
            <i class="fa fa-check-circle" style="font-size: 1.5rem; color: #27ae60; margin-bottom: 8px;"></i>
            <p style="margin: 0; font-size: 0.8rem;">No expired DDCs</p>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="expired-card">
      <div class="expired-header">
        <i class="fa fa-heartbeat" style="margin-right: 10px;"></i>
        Expired Medical
      </div>
      <div class="expired-content">
        {% for driver in expired_general_list %}
          <div class="expired-item">
            <div class="expired-avatar">
              <i class="fa fa-user"></i>
            </div>
            <div class="expired-details">
              <h6><a href="{% url 'driverview' driver_id=driver.D_ID %}" style="text-decoration: none; color: #2c3e50;">{{ driver.D_Name }}</a></h6>
              <p><strong>{{ driver.D_Number }}</strong> | {{ driver.CNIC_Validity }}</p>
            </div>
            <span class="danger-badge">Expired</span>
          </div>
        {% empty %}
          <div style="text-align: center; color: #666; padding: 20px;">
            <i class="fa fa-check-circle" style="font-size: 1.5rem; color: #27ae60; margin-bottom: 8px;"></i>
            <p style="margin: 0; font-size: 0.8rem;">No expired medical certificates</p>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="expired-card">
      <div class="expired-header">
        <i class="fa fa-id-badge" style="margin-right: 10px;"></i>
        Expired HTV License
      </div>
      <div class="expired-content">
        {% for driver in expired_htv_license_list %}
          <div class="expired-item">
            <div class="expired-avatar">
              <i class="fa fa-user"></i>
            </div>
            <div class="expired-details">
              <h6><a href="{% url 'driverview' driver_id=driver.D_ID %}" style="text-decoration: none; color: #2c3e50;">{{ driver.D_Name }}</a></h6>
              <p><strong>{{ driver.D_Number }}</strong> | {{ driver.CNIC_Validity }}</p>
            </div>
            <span class="danger-badge">Expired</span>
          </div>
        {% empty %}
          <div style="text-align: center; color: #666; padding: 20px;">
            <i class="fa fa-check-circle" style="font-size: 1.5rem; color: #27ae60; margin-bottom: 8px;"></i>
            <p style="margin: 0; font-size: 0.8rem;">No expired HTV licenses</p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

</div>

<script>
  const tbm_data = JSON.parse('{{ tbm_data|escapejs }}')
  
  // Modern color palette for bars
  const colorPalette = ['rgb(108, 122, 224)']
  
  // Chart data
  const data = {
    labels: ['Syndicate Sessions', 'Heat Stress Management', 'Pre-load Inspection', 'Safe Decantation at Retail Site', 'Roll Over Prevention', 'Fatigue Management', 'Defensive Driving', 'Unauthorized Passenger', 'Loading & Unloading', '360 Walkabout Process', 'Vehicle Fitness', 'Emergency Response', 'PPE Compliance', 'Duty & Driving Hours', 'On-Road Distraction', 'Security Awareness', 'Manual Handling', 'Working at Height', 'Adverse Weather Condition', 'Static Charge', 'Driver Behavior on Road', 'Foggy Weather', 'Sugarcane Trolleys Hazards and Controls', 'NMPI Reporting', 'Black Spots'],
    datasets: [
      {
        label: 'Meeting attended by Drivers',
        data: tbm_data,
        backgroundColor: 'rgba(108, 122, 224, 0.8)',
        borderColor: 'rgba(108, 122, 224, 1)',
        borderWidth: 1,
        borderRadius: 8,
        borderSkipped: false,
      }
    ]
  }
  
  const options = {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        beginAtZero: true,
        maxRotation: 45,
        minRotation: 0,
        grid: {
          display: false
        },
        ticks: {
          color: '#666',
          font: {
            size: 11
          }
        }
      },
      y: {
        beginAtZero: true,
        stepSize: 10,
        max: 150,
        grid: {
          color: 'rgba(0,0,0,0.05)'
        },
        ticks: {
          color: '#666',
          font: {
            size: 11
          }
        }
      }
    },
    plugins: {
      legend: {
        display: false
      },
      tooltip: {
        enabled: true,
        mode: 'index',
        intersect: false,
        backgroundColor: 'rgba(0,0,0,0.8)',
        titleColor: 'white',
        bodyColor: 'white',
        borderColor: '#6c7ae0',
        borderWidth: 1
      }
    },
    animation: {
      duration: 2000,
      easing: 'easeOutQuart'
    }
  }
  
  // Create a bar chart
  const ctx = document.getElementById('barChart').getContext('2d')
  const myBarChart = new Chart(ctx, {
    type: 'bar',
    data: data,
    options: options
  })
</script>

{% endblock %}
